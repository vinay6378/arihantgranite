{% extends 'base.html' %}
{% block title %}Granite Varieties â€“ Arihant Granite's{% endblock %}
{% block content %}
<section class="py-20 bg-white">
  <div class="container mx-auto px-4">
    <h1 class="text-4xl md:text-5xl font-bold mb-8 text-center text-gray-900 mb-12">Explore Our Granite Varieties</h1>
    
    <!-- Search and Filter Bar -->
    <div class="mb-12 flex flex-col md:flex-row gap-4 items-center justify-between max-w-4xl mx-auto">
      <input type="text" id="product-search" class="w-full md:w-2/3 px-6 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-gray-900 transition-colors" placeholder="Search by name...">
      <select id="product-filter" class="w-full md:w-1/3 px-6 py-4 border-2 border-gray-200 rounded-xl focus:outline-none focus:border-gray-900 transition-colors">
        <option value="">All Categories</option>
        {% for cat in listings|map(attribute='category')|unique %}
        <option value="{{ cat }}">{{ cat }}</option>
        {% endfor %}
      </select>
    </div>
    
    <!-- Responsive Gallery -->
    <div id="product-gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
      {% for listing in listings %}
      <div class="product-card reveal group cursor-pointer" data-product-index="{{ loop.index0 }}" data-category="{{ listing.category }}">
        <div class="relative overflow-hidden rounded-lg mb-4">
          <img src="{{ listing.image }}" class="w-full h-64 object-cover transition-transform duration-700 group-hover:scale-110" alt="{{ listing.title }} granite">
          <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm text-gray-900 px-3 py-1 rounded-full text-xs font-bold">
            {{ listing.category }}
          </div>
          {% if listing.availability == 'Limited Stock' %}
          <div class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold">
            Limited Stock
          </div>
          {% endif %}
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
            <div class="p-6 text-white transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
              <button class="modern-btn secondary bg-white text-gray-900 text-sm">View Details</button>
            </div>
          </div>
        </div>
        <div class="p-4">
          <h2 class="text-xl font-bold text-gray-900 mb-2">{{ listing.title }}</h2>
          <p class="text-sm text-gray-500 mb-3 font-medium">{{ listing.category }}</p>
          <p class="text-sm text-gray-600 mb-4 line-clamp-2">{{ listing.description }}</p>
          <div class="flex justify-between text-xs text-gray-500 mb-4 border-t border-gray-100 pt-4">
            <span class="flex items-center gap-1">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
              {{ listing.thickness }}
            </span>
            <span class="flex items-center gap-1">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
              </svg>
              {{ listing.finish }}
            </span>
          </div>
          <button class="modern-btn secondary w-full text-sm">View Details</button>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<!-- Product Details Modal -->
<div id="product-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full p-8 relative m-4 max-h-[90vh] overflow-y-auto transform scale-95 modal-content">
    <button id="close-modal-btn" class="absolute top-4 right-4 text-2xl text-gray-400 hover:text-gray-900 transition-colors">&times;</button>
    <div class="grid md:grid-cols-2 gap-8">
      <div>
        <img id="modal-img" src="" class="w-full h-full min-h-[400px] object-cover rounded-lg" alt="Product image">
      </div>
      <div>
        <h2 id="modal-title" class="text-3xl font-bold text-gray-900 mb-3"></h2>
        <p id="modal-category" class="text-gray-600 font-semibold mb-4 text-lg"></p>
        <p id="modal-desc" class="mb-6 text-gray-600 leading-relaxed"></p>
        <div class="space-y-3 mb-6 border-t border-gray-200 pt-6">
          <p id="modal-availability" class="text-sm font-medium"></p>
          <div class="flex gap-6 text-sm text-gray-600">
            <span id="modal-thickness" class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
              </svg>
            </span>
            <span id="modal-finish" class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
              </svg>
            </span>
          </div>
        </div>
        <div class="flex gap-3">
          <a href="/contact" class="modern-btn primary flex-1 text-center">Get Quote</a>
          <a href="/contact" class="modern-btn secondary flex-1 text-center">Contact Us</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Modal logic
  const products = {{ listings|tojson }};
  
  function showModal(idx) {
    const p = products[idx];
    document.getElementById('modal-img').src = p.image;
    document.getElementById('modal-title').textContent = p.title;
    document.getElementById('modal-category').textContent = p.category;
    document.getElementById('modal-desc').textContent = p.description;
    document.getElementById('modal-availability').textContent = `Availability: ${p.availability}`;
    document.getElementById('modal-thickness').textContent = `Thickness: ${p.thickness}`;
    document.getElementById('modal-finish').textContent = `Finish: ${p.finish}`;
    const modal = document.getElementById('product-modal');
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
    setTimeout(() => {
      document.querySelector('.modal-content').style.transform = 'scale(1)';
    }, 10);
  }
  
  function closeModal() {
    const modal = document.getElementById('product-modal');
    document.querySelector('.modal-content').style.transform = 'scale(0.95)';
    setTimeout(() => {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }, 200);
  }
  
  // Close modal when clicking outside
  document.getElementById('product-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });
  
  // Search/filter logic
  const searchInput = document.getElementById('product-search');
  const filterSelect = document.getElementById('product-filter');
  const gallery = document.getElementById('product-gallery');
  
  function renderGallery() {
    const search = searchInput.value.toLowerCase();
    const filter = filterSelect.value;
    let html = '';
    let visibleCount = 0;
    
    products.forEach((p, i) => {
      if ((p.title.toLowerCase().includes(search) || p.description.toLowerCase().includes(search)) &&
          (!filter || p.category === filter)) {
        visibleCount++;
        const stockBadge = p.availability === 'Limited Stock' ? 
          '<div class="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-xs font-bold">Limited Stock</div>' : '';
        
        html += `
          <div class="product-card reveal group cursor-pointer" data-product-index="${i}" data-category="${p.category}">
            <div class="relative overflow-hidden rounded-lg mb-4">
              <img src="${p.image}" class="w-full h-64 object-cover transition-transform duration-700 group-hover:scale-110" alt="${p.title} granite">
              <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm text-gray-900 px-3 py-1 rounded-full text-xs font-bold">${p.category}</div>
              ${stockBadge}
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
                <div class="p-6 text-white transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300">
                  <button class="modern-btn secondary bg-white text-gray-900 text-sm">View Details</button>
                </div>
              </div>
            </div>
            <div class="p-4">
              <h2 class="text-xl font-bold text-gray-900 mb-2">${p.title}</h2>
              <p class="text-sm text-gray-500 mb-3 font-medium">${p.category}</p>
              <p class="text-sm text-gray-600 mb-4 line-clamp-2">${p.description}</p>
              <div class="flex justify-between text-xs text-gray-500 mb-4 border-t border-gray-100 pt-4">
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                  </svg>
                  ${p.thickness}
                </span>
                <span class="flex items-center gap-1">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zM21 5a2 2 0 00-2-2h-4a2 2 0 00-2 2v12a4 4 0 004 4h4a2 2 0 002-2V5z"></path>
                  </svg>
                  ${p.finish}
                </span>
              </div>
              <button class="modern-btn secondary w-full text-sm">View Details</button>
            </div>
          </div>
        `;
      }
    });
    
    if (visibleCount === 0) {
      html = '<div class="col-span-full text-center py-12"><p class="text-gray-600 text-lg">No products found matching your criteria.</p></div>';
    }
    
    gallery.innerHTML = html;
    
    // Re-initialize reveal animations
    const reveals = gallery.querySelectorAll('.reveal');
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active');
        }
      });
    }, { threshold: 0.1 });
    
    reveals.forEach(reveal => {
      revealObserver.observe(reveal);
    });
    
    // Re-attach click handlers
    gallery.querySelectorAll('[data-product-index]').forEach(card => {
      card.addEventListener('click', function() {
        const index = parseInt(this.getAttribute('data-product-index'));
        showModal(index);
      });
    });
  }
  
  searchInput.oninput = renderGallery;
  filterSelect.onchange = renderGallery;
  
  // Initialize gallery on page load
  document.addEventListener('DOMContentLoaded', function() {
    renderGallery();
    document.getElementById('close-modal-btn').addEventListener('click', closeModal);
    
    // Scroll reveal for initial load
    const reveals = document.querySelectorAll('.reveal');
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active');
        }
      });
    }, { threshold: 0.1 });
    
    reveals.forEach(reveal => {
      revealObserver.observe(reveal);
    });
  });
</script>
{% endblock %}
